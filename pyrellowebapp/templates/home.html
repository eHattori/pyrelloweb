{% extends 'base.html' %}
{% block content %}
{% load graphics_tags %}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<div class="page-content-wrapper">
<div class="main-container container-fluid">
  {% page request as page %}
    <div>
        <div>
          <form method="get"><input type="hidden" name="board_id"
            value="{{page.board_id}}"/> <text class="page-title">
            {{page.title }}</h3>
          {% if page.number_of_days %}
          <h6>Últimos <input type="text" name="number_of_days" size="3" value="{{page.number_of_days}}"/> dias</h6>
          {% endif %}
          </form>
        </div>
    </div>

    {% throughput request as throughput_items %}

    {% leadtime request as leadtime_items %}
    {% if leadtime_items %}
     <div class="row">
      <div class="col-md-3">
        <div class="card card-single-value mb-3">
          <div class="card-header">90 Percentil Leadtime</div>
          <div class="card-body">
            <text class="card-title">{{ leadtime_items.1 }}</text>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card card-single-value mb-3">
          <div class="card-header">Média Throughput</div>
          <div class="card-body">
            <text class="card-title">{{ throughput_items.mean}}</text>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card card-single-value mb-3">
          <div class="card-header">Mediana Throughput</div>
          <div class="card-body">
            <text class="card-title">{{ throughput_items.median }}</text>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card card-single-value mb-3">
          <div class="card-header">Carga de Falha</div>
          <div class="card-body">
            <text class="card-title">{{ throughput_items.defectload }}%</text>
          </div>
        </div>
      </div>

    </div>
    {% endif %}
    {% cfd request as cfd_items %}
    {% if cfd_items %}
    <div class="row">
        <div class="col-md-12">
            <div class="card card-single-value mb-3">   
                <div class="card-header">
                    <text class="card-title">CFD</text>
                </div>
                <div class="card-body">
                    <div id="cfd"></div>
                </div>
                <script type="text/javascript">
                      google.charts.load('current', {'packages':['corechart']});
                      google.charts.setOnLoadCallback(drawChart);

                      function drawChart() {
                        {% autoescape off %}
                        var data = google.visualization.arrayToDataTable({{ cfd_items }});
                        {% endautoescape %}
                        var options = {
                          isStacked: true,
                          title: 'Cumulative Flow Diagram',
                          hAxis: {title: 'Dia',  titleTextStyle: {color: '#333'}},
                          vAxis: {minValue: 0},
                          height: 400,
                        };

                        var chart = new
                          google.visualization.AreaChart(document.getElementById('cfd'));
                        chart.draw(data, options);
                      }
                </script>
            </div>
        </div>
    </div>
    {% endif %}



    {% if throughput_items.data %}
    <div class="row">
        <div class="col-md-12">
            <div class="card card-single-value mb-3">   
                <div class="card-header">
                    <text class="card-title">Throughput</text>
                </div>
                <div class="card-body">
                    <div id="throughput"></div>
                </div>

                <script type="text/javascript">
                    google.charts.load('current', {packages: ['corechart', 'bar']});
                    google.charts.setOnLoadCallback(drawBasic);

                    function drawBasic() {

                          var data = new google.visualization.DataTable();
                          data.addColumn('string', 'Semana');
                      {% for type in throughput_items.labels %}
                      data.addColumn('number', '{{type.1}}');
                      {% endfor %}

                      {% autoescape off %}
                      var list_data = {{throughput_items.data }}
                      {% endautoescape%}
                          data.addRows(list_data);

                          var options = {
                            title: 'Quantidade de entregas semanais',
                            isStacked: true,
                            height: 400,
                            hAxis: {
                              title: 'Semanas',
                            },
                            vAxis: {
                              title: 'Quantidade de itens'
                            }
                          };

                          var chart = new google.visualization.ColumnChart(
                            document.getElementById('throughput'));

                          chart.draw(data, options);
                        }
                </script>
            </div>
        </div>
    </div>
    {% endif %}



    {% if leadtime_items %}
    <div class="row">
        <div class="col-md-12">
            <div class="card card-single-value mb-3">   
                <div class="card-header">
                    <text class="card-title">Leadtime</text>
                </div>
                <div class="card-body">
                  <div id="leadtime"> </div>
                </div>

                <script type="text/javascript">
                    google.charts.load('current', {packages: ['corechart', 'line']});
                    google.charts.setOnLoadCallback(drawBasic);

                    function drawBasic() {

                          var data = new google.visualization.DataTable();
                          data.addColumn('number', 'X');
                          data.addColumn('number', 'Card');


                              var list_data = [
                                  {% for item in leadtime_items %}
                                [{v:{{ forloop.counter0 }}, f:'{{item.leadtime}} days'},  {v:{{item.leadtime}}, f:'{{item.card.name}}'}],
                                  {% endfor %}
                                ]

                          data.addRows(list_data);

                          var options = {
                            hAxis: {
                              title: 'Cards'
                            },
                            vAxis: {
                              title: 'Days'
                            }
                          };

                          var chart = new
                        google.visualization.LineChart(document.getElementById('leadtime'));

                          chart.draw(data, options);
                        }
               </script>
            </div>
        </div>
    </div>
    {% endif %}

    {% histogram request as histogram_items %}
    {% if histogram_items %}
    <div class="row">
        <div class="col-md-12">
            <div class="card card-single-value mb-3">
                <div class="card-header">
                    <text class="card-title">Histogram</text>
                </div>
                <div class="card-body">
                    <div id="histogram"></div>
                </div>

                <script type="text/javascript">
                    var card = "card";
                    google.charts.load("current", {packages:["corechart"]});
                    google.charts.setOnLoadCallback(drawChart);
                    function drawChart() {
                      var list_data = {% autoescape off %}{{histogram_items}};{% endautoescape %}
                      var data = google.visualization.arrayToDataTable(list_data);
                    
                      var options = {
                        title: 'Quantidade de cards entregues por período de tempo',
                        legend: { position: 'none' },
                      };
                    
                      var chart = new google.visualization.Histogram(document.getElementById('histogram'));
                      chart.draw(data, options);
                    }
                </script>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}
